{% extends 'menu_template.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/postCheck.css' %}">
<script type="text/javascript" src="{% static 'js/check.js' %}"></script>

<br><br>
<div class="container">
    {% if post %}
    <div class="card mb-3" style="width: auto;">
        <div class="row no-gutters">
            <div class="col-md-4">
                <!-- 예진 : src부분에서 {% static 'img/dog.png' %}를 지우고 DB에서 잃어버린 동물 사진을 받아와야 합니당~ 아직 DB에 동물 사진 없으므로 나중에 할 예정 -->
                {% if post.image %}
                    <img src="{{ post.image.url }}" class="card-img" id="animalImg">
                {% else %}
                    <img src="{% static 'img/dog.png' %}" class="card-img" id="animalImg">
                {% endif %}
            </div>
            <div class="col-md-8">
                <div class="card-body">
                    <!-- 예진 : 작성일 지우고 db에서 작성일 받아오는 코드 넣어주면 돼요~ ex)post.date-->
                    <p class="card-text" id="pub_date" style="text-align:right;" id="reportingDate">등록날짜 : {{ post.pub_date }}</p>
                    <p class="card-text" id="up_date" style="text-align:right;" id="updateDate">수정날짜 : {{ post.up_date }}</p>
                    <br>
                    {% if post.shelter %}
                    <p class="card-text" id="shelter">글작성자 : {{ post.shelter.name }} <button class="btn btn-link" onclick="window.open('address','보호소 위치','width=430,height=500,location=no,status=no,scrollbars=yes');"><img width="20" height="20" style="margin-left: -13px; margin-top: -9px" src="{% static 'img/gps.png' %}"></button></p> 
                    <p class="card-text" id="location">잃어버린 위치(찾은 위치) : {{ post.location }}</p>
                    <p class="card-text" id="date">잃어버린 날짜 : {{ post.date }}</p>
                    <p class="card-text" id="feature">특징 : {{ post.feature }}</p>
                    <p class="card-text" id="contact">연락처 : {{ post.shelter.phone }}</p>
                    {% else %}
                    <!-- 예진 : 이름 지우고 db에서 이름 받아오는 코드 넣어주면 돼요~ -->
                    <p class="card-text" id="name">글작성자 : {{ post.user.username }} <button class="btn btn-link" onclick="window.open('address','쪽지 쓰기','width=430,height=500,location=no,status=no,scrollbars=yes');"><img width="20" height="20" style="margin-left: -13px; margin-top: -9px" src="{% static 'img/email.png' %}"></button></p>
                    <!-- 예진 : 잃어버린 위치(찾은 위치) 지우고 db에서 잃어버린 위치(찾은 위치) 받아오는 코드 넣어주면 돼요~ -->
                    <p class="card-text" id="location">잃어버린 위치(찾은 위치) : {{ post.location }}</p>
                    <p class="card-text" id="date">잃어버린 날짜 : {{ post.date }}</p>
                    <!-- 예진 : 특징 지우고 db에서 특징 받아오는 코드 넣어주면 돼요~ -->
                    <p class="card-text" id="feature">특징 : {{ post.feature }}</p>
                    <!-- 예진 : 연락처 지우고 db에서 연락처 받아오는 코드 넣어주면 돼요~ -->
                    <p class="card-text" id="contact">연락처 : {{ post.user.phone }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- 목록 수정 삭제 버튼 폼 -->
    <div class="button" align="right">
        <!-- 예진 : href=""에 게시판 목록 돌아가는 함수 넣기 -->
        <a class="btn btn-default" href="{% url "website:homePost" %}" role="button">목록</a>
        <!-- 예진 : OnClick="location.href ='#'"에서 #안에 게시글 수정하는 함수 넣기 -->
        <button type="submit" OnClick="location.href ='{% url "website:edit" post_id=post.id %}'" class="btn btn-default">수정</button>
<!--        <button type="submit" OnClick="location.href ='#'" class="btn btn-default">수정</button>-->
        <!-- 예진 : OnClick="location.href ='#'"에서 #안에 게시글 삭제하는 함수 넣기 -->
        <button type="submit" OnClick="removeData(); location.href ='{% url "website:delete" post_id=post.id %}'" class="btn btn-default">삭제</button>
<!--        <button type="submit" OnClick="location.href ='#'" class="btn btn-default">삭제</button>-->
    </div>
    {% endif %}

    <br><br>
    <strong>댓글</strong>
    <br><br>

    <!-- 댓글 작성 폼 -->
    <div class="commentWrite">
        <!-- 예진 : if문으로 로그인이 되어 있으면 넣기
        ex)  -->
        {% if user.is_authenticated %}
        <form method="post">
            {% csrf_token %}
            {% if user %}
            <!-- 예진 : src="{% static 'img/black1.gif' %}"에 {% static 'img/black1.gif' %} 지우고 현재 유저 이미지 받아오는 코드 넣기-->
            {% if user.image %}
            <img src="{{ user.image }}" alt="유저 아이콘" class="img-fluid rounded rounded-circle" id="commentUserImg">
            {% else %}
            <img src="{% static 'img/black1.gif' %}" alt="유저 아이콘" class="img-fluid rounded rounded-circle" id="commentUserImg">
            {% endif %}
            <span class="search_in"><input type="text" placeholder="댓글을 입력하세요" id="commentInput" name="comment"
                    style="border:none;"></span>
            <button type="submit" class="btn btn-default">확인</button>
            {% endif %}
        </form>
    </div>

    <!--댓글 출력-->
    <!-- 예진 : 반복문 통해서 댓글 db 가져오기 ex)  -->
    {% for comment in comments %}
    <div class="commentRead">
        <br>
        <div class="commentTable">
            <table>
                <tr>
                    <!-- 예진 : {% static 'img/black1.gif' %} 지우고 댓글 쓴 user의 아이콘 가져오기 -->
                    {% if comment.user.image %}
                    <td rowspan="2"><img src="{{ comment.user.image }}" alt="유저 아이콘" class="img-fluid rounded rounded-circle" id="commentUserImg"
                            style="margin-right: 15px;">
                    </td>
                    {% else %}
                    <td rowspan="2"><img src="{% static 'img/black1.gif' %}" alt="유저 아이콘" class="img-fluid rounded rounded-circle" id="commentUserImg"
                            style="margin-right: 15px;">
                    </td>
                    {% endif %}
                    <!-- 예진 : 아이디 지우고 댓글 쓴 user의 아이디 가져오기-->
                    <td>{{ comment.user.userID }}</td>
                </tr>
                <tr>
                    <!-- 예진 : 쪽지 주세요~ 지우고 user가 쓴 댓글 내용 가져오기 -->
                    <td>{{ comment.comment }}</td>
                </tr>
            </table>
        </div>
        <div class="button" align="right">
            <!-- 예진 : if문으로 댓글 작성한 유저와 현재 유저가 같은지 확인하는 코드 넣기
            ex)  -->
            {% if user == comment.user.username %}
            <!-- 예진 : OnClick="location.href ='#'"에서 #안에 댓글 수정하는 함수 넣기 -->
            <button type="submit" OnClick="location.href ='{% url "website:comment_edit" pk=comment.pk %}'" class="btn btn-default">수정</button>
<!--            <button type="submit" OnClick="location.href ='#'" class="btn btn-default">수정</button>-->
            <!-- 예진 : OnClick="location.href ='#'"에서 #안에 댓글 삭제하는 함수 넣기 -->
            <button type="submit" OnClick="removeData(); location.href ='{% url "website:comment_delete" pk=comment.pk %}'" class="btn btn-default" >삭제</button>
<!--            <button type="submit" OnClick="location.href ='#'" class="btn btn-default">삭제</button>-->
            <!--  -->
            {% endif %}
        </div>
    </div>
    {% empty %}
    <br>
    <p>댓글이 없습니다.</p>
    {% endfor %}
    {% else %}
        <p>No Data</p>
    {% endif %}
</div>
{% endblock content %}